<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>阜宁县POI管理系统</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <!-- 侧边栏 -->
        <nav class="sidebar">
            <div class="logo">
                <h2>POI管理系统</h2>
                <span class="subtitle" id="current-region-name">加载中...</span>
            </div>
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    <span class="icon">📊</span> 数据概览
                </li>
                <li class="nav-item" data-page="settings">
                    <span class="icon">⚙️</span> API Key设置
                </li>
                <li class="nav-item" data-page="collector">
                    <span class="icon">📥</span> 数据采集
                </li>
                <li class="nav-item" data-page="search">
                    <span class="icon">🔍</span> 数据查询
                </li>
                <li class="nav-item" data-page="compare">
                    <span class="icon">📋</span> 平台对比
                </li>
            </ul>
        </nav>

        <!-- 主内容区 -->
        <main class="main-content">
            <!-- 数据概览页面 -->
            <section id="page-dashboard" class="page active">
                <h1>数据概览</h1>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-total">-</div>
                        <div class="stat-label">总数据量</div>
                    </div>
                    <div class="stat-card tianditu">
                        <div class="stat-value" id="stat-tianditu">-</div>
                        <div class="stat-label">天地图</div>
                    </div>
                    <div class="stat-card amap">
                        <div class="stat-value" id="stat-amap">-</div>
                        <div class="stat-label">高德地图</div>
                    </div>
                    <div class="stat-card baidu">
                        <div class="stat-value" id="stat-baidu">-</div>
                        <div class="stat-label">百度地图</div>
                    </div>
                </div>

                <h2>分类统计</h2>
                <div class="category-chart" id="category-chart"></div>
            </section>

            <!-- API Key设置页面 -->
            <section id="page-settings" class="page">
                <h1>API Key设置</h1>
                <p class="desc">配置各地图平台的API Key，支持多个Key自动轮换（当一个Key配额耗尽时自动使用下一个）</p>

                <div class="settings-grid">
                    <div class="setting-card">
                        <h3>天地图</h3>
                        <p class="hint">访问 <a href="https://console.tianditu.gov.cn/" target="_blank">天地图开发者平台</a> 申请</p>
                        <div class="key-list" id="keylist-tianditu"></div>
                        <div class="key-add-form">
                            <input type="text" id="keyname-tianditu" placeholder="备注名称（可选）" class="key-name-input">
                            <div class="input-group">
                                <input type="password" id="key-tianditu" placeholder="请输入API Key">
                                <button onclick="toggleKeyVisibility('tianditu')">👁</button>
                            </div>
                            <button class="btn btn-primary" onclick="addApiKey('tianditu')">添加Key</button>
                        </div>
                    </div>

                    <div class="setting-card">
                        <h3>高德地图</h3>
                        <p class="hint">访问 <a href="https://console.amap.com/" target="_blank">高德开放平台</a> 申请Web服务API Key</p>
                        <div class="key-list" id="keylist-amap"></div>
                        <div class="key-add-form">
                            <input type="text" id="keyname-amap" placeholder="备注名称（可选）" class="key-name-input">
                            <div class="input-group">
                                <input type="password" id="key-amap" placeholder="请输入API Key">
                                <button onclick="toggleKeyVisibility('amap')">👁</button>
                            </div>
                            <button class="btn btn-primary" onclick="addApiKey('amap')">添加Key</button>
                        </div>
                    </div>

                    <div class="setting-card">
                        <h3>百度地图</h3>
                        <p class="hint">访问 <a href="https://lbsyun.baidu.com/" target="_blank">百度地图开放平台</a> 申请服务端AK</p>
                        <div class="key-list" id="keylist-baidu"></div>
                        <div class="key-add-form">
                            <input type="text" id="keyname-baidu" placeholder="备注名称（可选）" class="key-name-input">
                            <div class="input-group">
                                <input type="password" id="key-baidu" placeholder="请输入API Key">
                                <button onclick="toggleKeyVisibility('baidu')">👁</button>
                            </div>
                            <button class="btn btn-primary" onclick="addApiKey('baidu')">添加Key</button>
                        </div>
                    </div>
                </div>

                <!-- 区域配置卡片 -->
                <div class="setting-card region-card">
                    <h3>📍 采集区域配置</h3>
                    <p class="hint">选择预设区域或自定义采集区域范围</p>
                    
                    <div class="region-selector">
                        <label>预设区域:</label>
                        <select id="region-preset" onchange="selectPresetRegion()">
                            <option value="">-- 选择预设区域 --</option>
                        </select>
                    </div>
                    
                    <div class="region-custom" id="region-custom-form">
                        <div class="region-row">
                            <label>区域名称:</label>
                            <input type="text" id="region-name" placeholder="如: 阜宁县">
                        </div>
                        <div class="region-row">
                            <label>行政代码:</label>
                            <input type="text" id="region-admin-code" placeholder="如: 320923">
                        </div>
                        <div class="region-row">
                            <label>城市代码:</label>
                            <input type="text" id="region-city-code" placeholder="如: 320900">
                        </div>
                        <div class="region-bounds">
                            <label>边界范围:</label>
                            <div class="bounds-grid">
                                <input type="number" step="0.01" id="region-min-lon" placeholder="最小经度">
                                <input type="number" step="0.01" id="region-max-lon" placeholder="最大经度">
                                <input type="number" step="0.01" id="region-min-lat" placeholder="最小纬度">
                                <input type="number" step="0.01" id="region-max-lat" placeholder="最大纬度">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveCustomRegion()">保存区域配置</button>
                        <span class="status" id="region-status"></span>
                    </div>
                    
                    <div class="region-current">
                        <strong>当前配置:</strong>
                        <span id="region-current-display">加载中...</span>
                    </div>
                </div>
            </section>

            <!-- 数据采集页面 -->
            <section id="page-collector" class="page">
                <h1>数据采集</h1>
                <p class="desc">从各平台采集<span id="collector-region-name">当前区域</span>POI数据，支持断点续采</p>

                <div class="collector-grid">
                    <!-- 天地图采集器 -->
                    <div class="collector-card" id="collector-tianditu">
                        <div class="collector-header">
                            <h3>天地图</h3>
                            <span class="collector-status" id="cstatus-tianditu">未开始</span>
                        </div>
                        <div class="collector-categories">
                            <div class="category-select-header">
                                <span>选择采集类别:</span>
                                <label class="select-all-label">
                                    <input type="checkbox" id="selectall-tianditu" onchange="toggleAllCategories('tianditu')" checked> 全选
                                </label>
                            </div>
                            <div class="category-checkboxes" id="categories-tianditu"></div>
                        </div>
                        <div class="collector-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="cprogress-tianditu" style="width: 0%"></div>
                            </div>
                            <div class="progress-text">
                                <span id="cprogress-text-tianditu">0 / 0 类别</span>
                                <span id="ccount-tianditu">已采集: 0</span>
                            </div>
                        </div>
                        <div class="collector-info" id="cinfo-tianditu"></div>
                        <div class="collector-actions">
                            <button class="btn btn-primary" onclick="startCollector('tianditu')">
                                <span id="cbtn-tianditu">开始采集</span>
                            </button>
                            <button class="btn btn-secondary" onclick="stopCollector('tianditu')">停止</button>
                            <button class="btn btn-danger" onclick="resetCollector('tianditu')">重置</button>
                        </div>
                    </div>

                    <!-- 高德采集器 -->
                    <div class="collector-card" id="collector-amap">
                        <div class="collector-header">
                            <h3>高德地图</h3>
                            <span class="collector-status" id="cstatus-amap">未开始</span>
                        </div>
                        <div class="collector-categories">
                            <div class="category-select-header">
                                <span>选择采集类别:</span>
                                <label class="select-all-label">
                                    <input type="checkbox" id="selectall-amap" onchange="toggleAllCategories('amap')" checked> 全选
                                </label>
                            </div>
                            <div class="category-checkboxes" id="categories-amap"></div>
                        </div>
                        <div class="collector-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="cprogress-amap" style="width: 0%"></div>
                            </div>
                            <div class="progress-text">
                                <span id="cprogress-text-amap">0 / 0 类别</span>
                                <span id="ccount-amap">已采集: 0</span>
                            </div>
                        </div>
                        <div class="collector-info" id="cinfo-amap"></div>
                        <div class="collector-actions">
                            <button class="btn btn-primary" onclick="startCollector('amap')">
                                <span id="cbtn-amap">开始采集</span>
                            </button>
                            <button class="btn btn-secondary" onclick="stopCollector('amap')">停止</button>
                            <button class="btn btn-danger" onclick="resetCollector('amap')">重置</button>
                        </div>
                    </div>

                    <!-- 百度采集器 -->
                    <div class="collector-card" id="collector-baidu">
                        <div class="collector-header">
                            <h3>百度地图</h3>
                            <span class="collector-status" id="cstatus-baidu">未开始</span>
                        </div>
                        <div class="collector-categories">
                            <div class="category-select-header">
                                <span>选择采集类别:</span>
                                <label class="select-all-label">
                                    <input type="checkbox" id="selectall-baidu" onchange="toggleAllCategories('baidu')" checked> 全选
                                </label>
                            </div>
                            <div class="category-checkboxes" id="categories-baidu"></div>
                        </div>
                        <div class="collector-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="cprogress-baidu" style="width: 0%"></div>
                            </div>
                            <div class="progress-text">
                                <span id="cprogress-text-baidu">0 / 0 类别</span>
                                <span id="ccount-baidu">已采集: 0</span>
                            </div>
                        </div>
                        <div class="collector-info" id="cinfo-baidu"></div>
                        <div class="collector-actions">
                            <button class="btn btn-primary" onclick="startCollector('baidu')">
                                <span id="cbtn-baidu">开始采集</span>
                            </button>
                            <button class="btn btn-secondary" onclick="stopCollector('baidu')">停止</button>
                            <button class="btn btn-danger" onclick="resetCollector('baidu')">重置</button>
                        </div>
                    </div>
                </div>

                <div class="collector-legend">
                    <h3>类别状态说明</h3>
                    <div class="category-tags" id="category-tags"></div>
                </div>

                <!-- 实时日志 -->
                <div class="log-panel">
                    <div class="log-header">
                        <h3>采集日志</h3>
                        <select id="log-platform" onchange="switchLogPlatform()">
                            <option value="">选择平台</option>
                            <option value="tianditu">天地图</option>
                            <option value="amap">高德地图</option>
                            <option value="baidu">百度地图</option>
                        </select>
                        <button class="btn btn-secondary" onclick="clearLogs()">清空</button>
                    </div>
                    <div class="log-content" id="log-content">
                        <p class="log-placeholder">选择平台查看采集日志...</p>
                    </div>
                </div>
            </section>

            <!-- 数据查询页面 -->
            <section id="page-search" class="page">
                <h1>数据查询</h1>

                <div class="search-box">
                    <input type="text" id="search-input" placeholder="输入地点名称搜索..." onkeypress="if(event.key==='Enter')doSearch()">
                    <select id="search-platform">
                        <option value="all">全部平台</option>
                        <option value="tianditu">天地图</option>
                        <option value="amap">高德地图</option>
                        <option value="baidu">百度地图</option>
                    </select>
                    <select id="search-mode">
                        <option value="smart">智能匹配</option>
                        <option value="exact">精确匹配</option>
                        <option value="prefix">前缀匹配</option>
                        <option value="contains">包含匹配</option>
                        <option value="fuzzy">模糊匹配</option>
                    </select>
                    <button class="btn btn-primary" onclick="doSearch()">搜索</button>
                </div>

                <div class="search-results" id="search-results">
                    <p class="placeholder">请输入关键词进行搜索</p>
                </div>
            </section>

            <!-- 平台对比页面 -->
            <section id="page-compare" class="page">
                <h1>平台数据对比</h1>
                <p class="desc">对比三个平台对同一地点的搜索结果</p>

                <div class="search-box">
                    <input type="text" id="compare-input" placeholder="输入地点名称进行对比..." onkeypress="if(event.key==='Enter')doCompare()">
                    <button class="btn btn-primary" onclick="doCompare()">对比搜索</button>
                </div>

                <div class="compare-grid" id="compare-results">
                    <div class="compare-column">
                        <h3>天地图</h3>
                        <div class="compare-list" id="compare-tianditu">
                            <p class="placeholder">等待搜索...</p>
                        </div>
                    </div>
                    <div class="compare-column">
                        <h3>高德地图</h3>
                        <div class="compare-list" id="compare-amap">
                            <p class="placeholder">等待搜索...</p>
                        </div>
                    </div>
                    <div class="compare-column">
                        <h3>百度地图</h3>
                        <div class="compare-list" id="compare-baidu">
                            <p class="placeholder">等待搜索...</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
